<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.PageTitle}} - aq3cms</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
        .header { background: #2c3e50; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 24px; }
        .header .user-info { display: flex; align-items: center; gap: 15px; }
        .header .user-info a { color: white; text-decoration: none; }
        .header .user-info a:hover { text-decoration: underline; }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .breadcrumb { background: white; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .breadcrumb a { color: #3498db; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { color: #666; margin: 0 8px; }
        .function-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .function-card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .function-card h3 { margin: 0 0 15px 0; color: #2c3e50; display: flex; align-items: center; gap: 10px; }
        .function-card .description { color: #666; margin-bottom: 20px; line-height: 1.5; }
        .function-card .actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; text-decoration: none; display: inline-block; transition: all 0.2s; }
        .btn-primary { background: #3498db; color: white; }
        .btn-primary:hover { background: #2980b9; }
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #229954; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-warning:hover { background: #e67e22; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        .btn-secondary { background: #95a5a6; color: white; }
        .btn-secondary:hover { background: #7f8c8d; }
        .alert { padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info-section { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .info-section h3 { margin: 0 0 20px 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .info-item { padding: 15px; background: #f8f9fa; border-radius: 5px; text-align: center; }
        .info-value { font-size: 24px; font-weight: bold; color: #2c3e50; }
        .info-label { color: #666; margin-top: 5px; font-size: 14px; }
        .upload-area { border: 2px dashed #ddd; border-radius: 8px; padding: 30px; text-align: center; background: #fafafa; margin: 15px 0; }
        .upload-area:hover { border-color: #3498db; background: #f0f8ff; }
        .upload-area input[type="file"] { display: none; }
        .upload-label { cursor: pointer; color: #3498db; font-weight: bold; }
        .upload-label:hover { color: #2980b9; }
        .file-info { margin-top: 10px; color: #666; font-size: 14px; }
        .progress-bar { width: 100%; height: 20px; background: #f0f0f0; border-radius: 10px; overflow: hidden; margin: 10px 0; display: none; }
        .progress-fill { height: 100%; background: #3498db; width: 0%; transition: width 0.3s; }
        .table-list { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .table-list table { width: 100%; border-collapse: collapse; }
        .table-list th, .table-list td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; }
        .table-list th { background: #f8f9fa; font-weight: bold; color: #555; }
        .table-list tr:hover { background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ—„ï¸ æ•°æ®åº“ç®¡ç†</h1>
        <div class="user-info">
            <span>æ¬¢è¿ï¼Œ{{.AdminName}}</span>
            <a href="/aq3cms/">è¿”å›é¦–é¡µ</a>
            <a href="/aq3cms/setting">è®¾ç½®é¦–é¡µ</a>
            <a href="/aq3cms/system_config">ç³»ç»Ÿé…ç½®</a>
            <a href="/">æŸ¥çœ‹ç½‘ç«™</a>
            <a href="/aq3cms/logout">é€€å‡ºç™»å½•</a>
        </div>
    </div>

    <div class="container">
        <div class="breadcrumb">
            <a href="/aq3cms/">ç®¡ç†é¦–é¡µ</a>
            <span>></span>
            <a href="/aq3cms/setting">ç³»ç»Ÿè®¾ç½®</a>
            <span>></span>
            <span>æ•°æ®åº“ç®¡ç†</span>
        </div>

        {{if .Message}}
        <div class="alert alert-{{.MessageType}}">
            {{.Message}}
        </div>
        {{end}}

        <div class="info-section">
            <h3>ğŸ“Š æ•°æ®åº“ä¿¡æ¯</h3>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-value">{{.Config.Database.Type}}</div>
                    <div class="info-label">æ•°æ®åº“ç±»å‹</div>
                </div>
                <div class="info-item">
                    <div class="info-value">{{.Config.Database.Host}}:{{.Config.Database.Port}}</div>
                    <div class="info-label">æœåŠ¡å™¨åœ°å€</div>
                </div>
                <div class="info-item">
                    <div class="info-value">{{.Config.Database.Database}}</div>
                    <div class="info-label">æ•°æ®åº“åç§°</div>
                </div>
                <div class="info-item">
                    <div class="info-value">{{.Config.Database.Prefix}}</div>
                    <div class="info-label">è¡¨å‰ç¼€</div>
                </div>
                <div class="info-item">
                    <div class="info-value">{{.Config.Database.Charset}}</div>
                    <div class="info-label">å­—ç¬¦é›†</div>
                </div>
                <div class="info-item">
                    <div class="info-value">åœ¨çº¿</div>
                    <div class="info-label">è¿æ¥çŠ¶æ€</div>
                </div>
            </div>
        </div>

        <div class="function-grid">
            <div class="function-card">
                <h3>ğŸ’¾ æ•°æ®åº“å¤‡ä»½</h3>
                <div class="description">
                    å°†å½“å‰æ•°æ®åº“å¯¼å‡ºä¸ºSQLæ–‡ä»¶ï¼Œç”¨äºæ•°æ®å¤‡ä»½å’Œè¿ç§»ã€‚å¤‡ä»½æ–‡ä»¶å°†ä¿å­˜åœ¨æœåŠ¡å™¨çš„å¤‡ä»½ç›®å½•ä¸­ã€‚
                </div>
                <div class="actions">
                    <button class="btn btn-success" onclick="backupDatabase()">ç«‹å³å¤‡ä»½</button>
                    <button class="btn btn-primary" onclick="downloadBackup()">ä¸‹è½½å¤‡ä»½</button>
                </div>
            </div>

            <div class="function-card">
                <h3>ğŸ“¥ æ•°æ®åº“æ¢å¤</h3>
                <div class="description">
                    ä»SQLå¤‡ä»½æ–‡ä»¶æ¢å¤æ•°æ®åº“ã€‚è¯·æ³¨æ„ï¼Œæ¢å¤æ“ä½œå°†è¦†ç›–å½“å‰æ•°æ®ï¼Œè¯·è°¨æ…æ“ä½œã€‚
                </div>
                <form id="restoreForm" enctype="multipart/form-data">
                    <div class="upload-area" onclick="document.getElementById('backupFile').click()">
                        <label class="upload-label">
                            ğŸ“ ç‚¹å‡»é€‰æ‹©å¤‡ä»½æ–‡ä»¶
                            <input type="file" id="backupFile" name="backup_file" accept=".sql" onchange="showFileInfo(this)">
                        </label>
                        <div class="file-info" id="fileInfo">æ”¯æŒ .sql æ ¼å¼çš„å¤‡ä»½æ–‡ä»¶</div>
                    </div>
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="actions">
                        <button type="button" class="btn btn-warning" onclick="restoreDatabase()">å¼€å§‹æ¢å¤</button>
                        <button type="button" class="btn btn-secondary" onclick="clearFile()">æ¸…é™¤æ–‡ä»¶</button>
                    </div>
                </form>
            </div>

            <div class="function-card">
                <h3>ğŸ”§ æ•°æ®åº“ä¼˜åŒ–</h3>
                <div class="description">
                    ä¼˜åŒ–æ•°æ®åº“è¡¨ç»“æ„ï¼Œæ¸…ç†ç¢ç‰‡ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚å»ºè®®å®šæœŸæ‰§è¡Œä»¥ä¿æŒæ•°æ®åº“æœ€ä½³çŠ¶æ€ã€‚
                </div>
                <div class="actions">
                    <button class="btn btn-primary" onclick="optimizeDatabase()">ä¼˜åŒ–æ•°æ®åº“</button>
                    <button class="btn btn-secondary" onclick="analyzeDatabase()">åˆ†æè¡¨</button>
                </div>
            </div>

            <div class="function-card">
                <h3>ğŸ§¹ æ•°æ®æ¸…ç†</h3>
                <div class="description">
                    æ¸…ç†è¿‡æœŸæ•°æ®ã€ä¸´æ—¶æ–‡ä»¶å’Œæ— ç”¨è®°å½•ï¼Œé‡Šæ”¾å­˜å‚¨ç©ºé—´ã€‚åŒ…æ‹¬æ—¥å¿—æ¸…ç†ã€ç¼“å­˜æ¸…ç†ç­‰ã€‚
                </div>
                <div class="actions">
                    <button class="btn btn-warning" onclick="cleanupData()">æ¸…ç†æ•°æ®</button>
                    <button class="btn btn-danger" onclick="clearLogs()" title="æ¸…é™¤ç³»ç»Ÿæ—¥å¿—">æ¸…é™¤æ—¥å¿—</button>
                </div>
            </div>

            <div class="function-card">
                <h3>ğŸ“‹ è¡¨ç®¡ç†</h3>
                <div class="description">
                    æŸ¥çœ‹å’Œç®¡ç†æ•°æ®åº“è¡¨ï¼ŒåŒ…æ‹¬è¡¨ç»“æ„æŸ¥çœ‹ã€æ•°æ®ç»Ÿè®¡ã€è¡¨ä¿®å¤ç­‰åŠŸèƒ½ã€‚
                </div>
                <div class="actions">
                    <button class="btn btn-primary" onclick="showTables()">æŸ¥çœ‹è¡¨</button>
                    <button class="btn btn-secondary" onclick="checkTables()">æ£€æŸ¥è¡¨</button>
                    <button class="btn btn-warning" onclick="repairTables()">ä¿®å¤è¡¨</button>
                </div>
            </div>

            <div class="function-card">
                <h3>ğŸ“ˆ æ•°æ®ç»Ÿè®¡</h3>
                <div class="description">
                    æŸ¥çœ‹æ•°æ®åº“ä½¿ç”¨ç»Ÿè®¡ï¼ŒåŒ…æ‹¬è¡¨å¤§å°ã€è®°å½•æ•°é‡ã€ç´¢å¼•ä½¿ç”¨æƒ…å†µç­‰è¯¦ç»†ä¿¡æ¯ã€‚
                </div>
                <div class="actions">
                    <button class="btn btn-primary" onclick="showStats()">æŸ¥çœ‹ç»Ÿè®¡</button>
                    <button class="btn btn-secondary" onclick="exportStats()">å¯¼å‡ºæŠ¥å‘Š</button>
                </div>
            </div>
        </div>

        <div class="table-list" id="tableList" style="display: none;">
            <h3 style="padding: 15px; margin: 0; background: #f8f9fa; border-bottom: 1px solid #eee;">æ•°æ®åº“è¡¨åˆ—è¡¨</h3>
            <table>
                <thead>
                    <tr>
                        <th>è¡¨å</th>
                        <th>è®°å½•æ•°</th>
                        <th>å¤§å°</th>
                        <th>å¼•æ“</th>
                        <th>å­—ç¬¦é›†</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td>{{.Config.Database.Prefix}}admin</td>
                        <td>1</td>
                        <td>16 KB</td>
                        <td>InnoDB</td>
                        <td>utf8mb4</td>
                        <td>
                            <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;">æŸ¥çœ‹</button>
                            <button class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;">ä¼˜åŒ–</button>
                        </td>
                    </tr>
                    <tr>
                        <td>{{.Config.Database.Prefix}}archives</td>
                        <td>0</td>
                        <td>16 KB</td>
                        <td>InnoDB</td>
                        <td>utf8mb4</td>
                        <td>
                            <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;">æŸ¥çœ‹</button>
                            <button class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;">ä¼˜åŒ–</button>
                        </td>
                    </tr>
                    <tr>
                        <td>{{.Config.Database.Prefix}}arctype</td>
                        <td>4</td>
                        <td>16 KB</td>
                        <td>InnoDB</td>
                        <td>utf8mb4</td>
                        <td>
                            <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;">æŸ¥çœ‹</button>
                            <button class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;">ä¼˜åŒ–</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function backupDatabase() {
            if (confirm('ç¡®å®šè¦å¤‡ä»½æ•°æ®åº“å—ï¼Ÿè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚')) {
                fetch('/aq3cms/system_backup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    }
                }).then(response => {
                    if (response.ok) {
                        alert('æ•°æ®åº“å¤‡ä»½æˆåŠŸï¼');
                        location.reload();
                    } else {
                        alert('å¤‡ä»½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚');
                    }
                }).catch(error => {
                    alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
                });
            }
        }

        function restoreDatabase() {
            const fileInput = document.getElementById('backupFile');
            if (!fileInput.files[0]) {
                alert('è¯·å…ˆé€‰æ‹©å¤‡ä»½æ–‡ä»¶ï¼');
                return;
            }

            if (confirm('ç¡®å®šè¦æ¢å¤æ•°æ®åº“å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œè¯·ç¡®ä¿å·²åšå¥½å¤‡ä»½ï¼')) {
                const formData = new FormData();
                formData.append('backup_file', fileInput.files[0]);

                const progressBar = document.getElementById('progressBar');
                const progressFill = document.getElementById('progressFill');
                
                progressBar.style.display = 'block';
                progressFill.style.width = '0%';

                // æ¨¡æ‹Ÿè¿›åº¦
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    progressFill.style.width = progress + '%';
                    if (progress >= 90) {
                        clearInterval(interval);
                    }
                }, 200);

                fetch('/aq3cms/system_restore', {
                    method: 'POST',
                    body: formData
                }).then(response => {
                    clearInterval(interval);
                    progressFill.style.width = '100%';
                    
                    setTimeout(() => {
                        progressBar.style.display = 'none';
                        if (response.ok) {
                            alert('æ•°æ®åº“æ¢å¤æˆåŠŸï¼');
                            location.reload();
                        } else {
                            alert('æ¢å¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¤‡ä»½æ–‡ä»¶æ ¼å¼ã€‚');
                        }
                    }, 500);
                }).catch(error => {
                    clearInterval(interval);
                    progressBar.style.display = 'none';
                    alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
                });
            }
        }

        function showFileInfo(input) {
            const fileInfo = document.getElementById('fileInfo');
            if (input.files[0]) {
                const file = input.files[0];
                const size = (file.size / 1024 / 1024).toFixed(2);
                fileInfo.innerHTML = `å·²é€‰æ‹©: ${file.name} (${size} MB)`;
            } else {
                fileInfo.innerHTML = 'æ”¯æŒ .sql æ ¼å¼çš„å¤‡ä»½æ–‡ä»¶';
            }
        }

        function clearFile() {
            document.getElementById('backupFile').value = '';
            document.getElementById('fileInfo').innerHTML = 'æ”¯æŒ .sql æ ¼å¼çš„å¤‡ä»½æ–‡ä»¶';
        }

        function optimizeDatabase() {
            if (confirm('ç¡®å®šè¦ä¼˜åŒ–æ•°æ®åº“å—ï¼Ÿè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚')) {
                alert('æ•°æ®åº“ä¼˜åŒ–åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
            }
        }

        function analyzeDatabase() {
            alert('æ•°æ®åº“åˆ†æåŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        function cleanupData() {
            if (confirm('ç¡®å®šè¦æ¸…ç†è¿‡æœŸæ•°æ®å—ï¼Ÿ')) {
                alert('æ•°æ®æ¸…ç†åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
            }
        }

        function clearLogs() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç³»ç»Ÿæ—¥å¿—å—ï¼Ÿ')) {
                alert('æ—¥å¿—æ¸…ç†åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
            }
        }

        function showTables() {
            const tableList = document.getElementById('tableList');
            if (tableList.style.display === 'none') {
                tableList.style.display = 'block';
                event.target.textContent = 'éšè—è¡¨';
            } else {
                tableList.style.display = 'none';
                event.target.textContent = 'æŸ¥çœ‹è¡¨';
            }
        }

        function checkTables() {
            alert('è¡¨æ£€æŸ¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        function repairTables() {
            if (confirm('ç¡®å®šè¦ä¿®å¤æ•°æ®åº“è¡¨å—ï¼Ÿ')) {
                alert('è¡¨ä¿®å¤åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
            }
        }

        function showStats() {
            alert('æ•°æ®ç»Ÿè®¡åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        function exportStats() {
            alert('ç»Ÿè®¡æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        function downloadBackup() {
            alert('å¤‡ä»½ä¸‹è½½åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }
    </script>
</body>
</html>
